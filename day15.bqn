lines â† â€¢FLinesâŠ‘â€¢args
mapâ€¿moves â† >Â¨ lines (â†‘ â‹ˆ 1âŠ¸+âŠ¸â†“)Ëœ âŠ‘/ âŸ¨âŸ©âŠ¸â‰¡Â¨ lines

Simulate â† {ğ•Šmapâ€¿markblob:
  map {moveğ•Šmap:
    push â† {'>':{Â»Ë˜};'<':{Â«Ë˜};'v':{Â»};'^':{Â«}} move
    pull â† {'>':{Â«Ë˜};'<':{Â»Ë˜};'v':{Â«};'^':{Â»}} move
    src â† MarkBlob mapâ€¿pushâ€¿pull
    dst â† Push src
    infrontâ€¿behind â† dst (âˆ§âŸœÂ¬ â‹ˆ Â¬âŠ¸âˆ§) src
    { âˆ¨Â´â¥Š('#'=map)âˆ§infront ? map;
      !âˆ§Â´â¥Š('.'=map)âˆ¨Â¬infront
      '.'Â¨âŒ¾((â¥Šbehind)âŠ¸/)âŒ¾â¥Š (src/â—‹â¥Šmap)âŒ¾((â¥Šdst)âŠ¸/)âŒ¾â¥Š map
    }
  }Â´âŒ½ â¥Šmoves
}

# flood fills to mark all the objects that will move (self and boxes)
_fx_ â† {F _ğ•£_ G ğ•©: âŠ‘{pâ€¿n: nâ‹ˆF n} â€¢_while_ (GÂ´) ğ•©â‹ˆFğ•© }
MarkBlob1 â† {ğ•Šmapâ€¿pushâ€¿pull:
  { ğ•© âˆ¨ Push ğ•©âˆ§"O"âˆŠËœPull map
  } _fx_ â‰¢ map='@'
}
MarkBlob2 â† {ğ•Šmapâ€¿pushâ€¿pull:
  { ğ•© âˆ¨ (Push ğ•©âˆ§"[]"âˆŠËœPull map) âˆ¨ (Â»Ë˜)âŠ¸âˆ¨âŸœ(Â«Ë˜)Â´ ğ•©âŠ¸âˆ§Â¨ mapâŠ¸=Â¨"[]"
  } _fx_ â‰¢ map='@'
}

finalmap â† Simulate mapâ€¿MarkBlob1 
â€¢Show +Â´ +Â´âˆ˜(100â€¿1âŠ¸Ã—)Â¨ 'O'âŠ¸=âŠ¸/â—‹â¥ŠâŸœ(â†•âˆ˜â‰¢) finalmap

map2 â† (1â€¿2Ã—â‰¢map)â¥Š >{'.':"..";'O':"[]";'#':"##";'@':"@."}Â¨ map
finalmap2 â† Simulate map2â€¿MarkBlob2
â€¢Show +Â´ +Â´âˆ˜(100â€¿1âŠ¸Ã—)Â¨ '['âŠ¸=âŠ¸/â—‹â¥ŠâŸœ(â†•âˆ˜â‰¢) finalmap2

